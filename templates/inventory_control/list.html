{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <p class="h3 mb-0">บัญชีคุมพัสดุ (ครุภัณฑ์)</p>
  <div>
    <a href="{{ url_for('add_inventory') }}" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> เพิ่มข้อมูล
    </a>
  </div>
</div>

<div><p class="h6 text-end">แบบ พ.3102-8</p></div>

<!-- Search Form -->
<div class="row mb-3">
  <div class="col-md-6">
    <form method="GET" class="d-flex">
      <input type="text" name="q" class="form-control" placeholder="ค้นหาชื่อพัสดุ..."
             value="{{ request.args.get('q', '') }}">
      <button type="submit" class="btn btn-outline-secondary ms-2">ค้นหา</button>
      {% if request.args.get('q') %}
      <a href="{{ url_for('inventory_control') }}" class="btn btn-outline-danger ms-2">ล้าง</a>
      {% endif %}
    </form>
  </div>
</div>

<div class="table-responsive">
<table class="table table-bordered text-center align-middle">
  <thead class="table-primary">
    <tr>
      <th colspan="2">
        ชื่อพัสดุ
        <div class="small text-muted">รายละเอียดเพิ่มเติม</div>
      </th>
      <th colspan="4">
        หมายเลขพัสดุ
        <div class="small text-muted">เพิ่มข้อความได้</div>
      </th>
      <th colspan="3">
        หน่วยนับ
        <div class="small text-muted">ข้อความบรรยาย</div>
      </th>
      <th colspan="2">
        อัตรา
        <div class="small text-muted">สามารถเพิ่มรายละเอียด</div>
      </th>
      <th rowspan="3">จัดการ</th>
    </tr>
    <tr>
      <th colspan="12">รายละเอียด</th>
    </tr>
    <tr>
      <th rowspan="3">ว.ด.ป.</th>
      <th rowspan="3">หลักฐาน</th>
      <th colspan="4">รับ</th>
      <th colspan="3">จ่าย</th>
      <th rowspan="3">คงคลัง</th>
      <th rowspan="3">ลายมือชื่อ</th>
    </tr>
    <tr>
      <th rowspan="2">วิธีการได้มา</th>
      <th rowspan="2">ประเภทเงิน</th>
      <th rowspan="2">ราคาต่อหน่วย</th>
      <th rowspan="2">จำนวน</th>
      <th colspan="2">ความต้องการ</th>
      <th rowspan="2">จำนวน</th>
      <th rowspan="2">ดำเนินการ</th>
    </tr>
    <tr>
      <th>ขั้นต้น</th>
      <th>ทดแทน</th>
    </tr>
  </thead>
  <tbody>
    {% if data %}
      {% for item in data %}
      <tr>
        <td>{{ item.date }}</td>
        <td>{{ item.evidence }}</td>
        <td>{{ item.acquisitionMethod }}</td>
        <td>{{ item.budgetType }}</td>
        <td>{{ "{:,.0f}".format(item.pricePerUnit) }}</td>
        <td>{{ item.receiveQuantity }}</td>
        <td>{{ "✔" if item.primaryNeed else "" }}</td>
        <td>{{ "✔" if item.replacementNeed else "" }}</td>
        <td>{{ item.distributeQuantity }}</td>
        <td>{{ item.remainingStock }}</td>
        <td>{{ item.signature }}</td>
        <td>
          <div class="btn-group-vertical btn-group-sm" role="group">
            <a href="{{ url_for('edit_inventory', item_id=item.itemId) }}"
               class="btn btn-warning btn-sm mb-1">
              <i class="bi bi-pencil"></i> แก้ไข
            </a>
            <form method="POST" action="{{ url_for('delete_inventory', item_id=item.itemId) }}"
                  style="display: inline;"
                  onsubmit="return confirm('คุณแน่ใจหรือไม่ที่จะลบข้อมูลนี้?')">
              <button type="submit" class="btn btn-danger btn-sm">
                <i class="bi bi-trash"></i> ลบ
              </button>
            </form>
          </div>
        </td>
      </tr>
      <tr class="table-light">
        <td colspan="12">
          <strong>{{ item.itemName }}</strong>
          {% if item.itemNumber %}
            - หมายเลข: {{ item.itemNumber }}
          {% endif %}
          {% if item.unit %}
            - หน่วย: {{ item.unit }}
          {% endif %}
          {% if item.rate %}
            - อัตรา: {{ "{:,.0f}".format(item.rate) }}
          {% endif %}
        </td>
        <td></td>
      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="13" class="text-muted">ไม่มีข้อมูล</td>
      </tr>
    {% endif %}
  </tbody>
</table>
</div>

<!-- แสดงจำนวนข้อมูลทั้งหมด -->
<div class="mt-3">
  <small class="text-muted">
    {% if data %}
      แสดงข้อมูลทั้งหมด {{ data|length }} รายการ
    {% endif %}
  </small>
</div>

{% endblock %}
