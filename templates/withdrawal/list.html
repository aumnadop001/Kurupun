{% extends "base.html" %} {% block content %}
<p class="h5 text-decoration-underline text-center">
  หน่วยเบิก - ฝ่ายบริหารทรัพยากร
</p>
<p class="h3 text-center">ทะเบียนใบเบิก-วัสดุ</p>
<div>
  <p class="h6 text-end">แบบ พ. 3105</p>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <a href="{{ url_for('add_withdrawal') }}" class="btn btn-success">
    <i class="fas fa-plus"></i> เพิ่มข้อมูล
  </a>
  <form method="get" class="d-flex" action="">
    <input type="text" name="q" class="form-control me-2" placeholder="ค้นหา..."
      value="{{ request.args.get('q', '') }}" style="width: 250px;">
    <button type="submit" class="btn btn-primary">ค้นหา</button>
  </form>
</div>
<table class="table table-striped table-bordered table-hover text-center align-middle">
  <thead class="table-primary">
    <tr>
      <th scope="col">ลำดับที่</th>
      <th scope="col">ทะเบียนที่</th>
      <th scope="col">วันที่ลงทะเบียน</th>
      <th scope="col">เอกสาร</th>
      <th scope="col">ถึง หรือ จาก</th>
      <th scope="col">รายการแรกในเอกสาร</th>
      <th scope="col">วันที่เก็บเข้าแฟ้ม</th>
      <th scope="col">เลขที่เอกสารที่เกี่ยวข้อง</th>
      <th scope="col">การจัดการ</th>
    </tr>
  </thead>
  <tbody>
    {% for record in data %}
    <tr>
      <td>{{ record.sequenceNo }}</td>
      <td>{{ record.registerNo }}</td>
      <td>{{ record.registerDate }}</td>
      <td>{{ record.documentName }}</td>
      <td>{{ record.senderReceiver }}</td>
      <td>{{ record.firstItem }}</td>
      <td>{{ record.filedDate }}</td>
      <td>{{ record.relatedDocumentNo }}</td>
      <td>
        <a href="{{ url_for('edit_withdrawal', register_no=record.registerNo) }}"
           class="btn btn-warning btn-sm me-2">
          <i class="fas fa-edit"></i> แก้ไข
        </a>
        <button type="button" class="btn btn-danger btn-sm"
                onclick="confirmDelete('{{ record.registerNo }}', '{{ record.documentName }}')">
          <i class="fas fa-trash"></i> ลบ
        </button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Hidden form สำหรับลบข้อมูล -->
<form id="deleteForm" method="POST" style="display: none;">
</form>

<script>
function confirmDelete(registerNo, documentName) {
  Swal.fire({
    title: 'ต้องการลบข้อมูลหรือไม่?',
    text: `ทะเบียนที่: ${registerNo}\nเอกสาร: ${documentName}`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'ลบ',
    cancelButtonText: 'ยกเลิก',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      // เปลี่ยน action ของ form และ submit
      const form = document.getElementById('deleteForm');
      form.action = `/withdrawal/delete/${registerNo}`;
      form.submit();
    }
  });
}
</script>

{% endblock %}